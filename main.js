(()=>{"use strict";const t=(t,e)=>({name:t,length:e}),e=document.getElementById("gamesboard-container"),o=document.querySelector(".options-container"),n=[t("destroyer",2),t("submarine",3),t("cruiser",3),t("battleship",4),t("carrier",5)];let r=0;const s=10,a=t=>{const o=document.createElement("div");o.classList.add("game-board"),e.appendChild(o),o.id=t;for(let t=0;t<100;t++){const e=document.createElement("div");e.classList.add("block"),e.id=t,o.appendChild(e)}};let l;const c=(t,e,o,n)=>{let r,a=e?o<=100-n.length?o:100-n.length:o<=100-s*n.length?o:o-n.length*s+s,l=[];for(let o=0;o<n.length;o++)e?l.push(t[Number(a)+o]):l.push(t[Number(a)+o*s]);r=e?l.every(((t,e)=>l[0].id%s!=s-(l.length-(e+1)))):l.every(((t,e)=>l[0].id<s*e+1+90));const c=l.every((t=>!t.classList.contains("taken")));return{shipBlocks:l,valid:r,notTaken:c}},i=(t,e,o)=>{const n=document.querySelectorAll(`#${t} div`);let a=Math.random()<.5,d="player"===t?0===r:a,u=Math.floor(Math.random()*s*s),m=o||u;const{shipBlocks:p,valid:h,notTaken:y}=c(n,d,m,e);h&&y?p.forEach((t=>{t.classList.add(e.name),t.classList.add("taken")})):("computer"===t&&i("computer",e,o),"player"===t&&(l=!0))};let d;const u=t=>{l=!1,d=t.target},m=t=>{t.preventDefault();const e=n[d.id];h(t.target.id,e)},p=t=>{const e=t.target.id,o=n[d.id];i("player",o,e),l||d.remove()},h=(t,e)=>{const o=document.querySelectorAll("#player div");let n=0===r;const{shipBlocks:s,valid:a,notTaken:l}=c(o,n,t,e);a&&l&&s.forEach((t=>{t.classList.add("hover"),setTimeout((()=>t.classList.remove("hover")),500)}))},y=document.getElementById("info"),f=document.getElementById("turn-display"),g=document.querySelector(".options-container");let v,L=!1,k=[],E=[];const C=[],b=[],x=()=>{L||(f.textContent="Computers turn!",y.textContent="The computer is preparing to fire...",setTimeout((()=>{let t=Math.floor(Math.random()*s*s);const e=document.querySelectorAll("#player div");if(e[t].classList.contains("taken")&&e[t].classList.contains("boom"))x();else if(e[t].classList.contains("taken")&&!e[t].classList.contains("boom")){e[t].classList.add("boom"),y.textContent="Computer hit!";let o=Array.from(e[t].classList);o=o.filter((t=>"block"!==t)),o=o.filter((t=>"boom"!==t)),o=o.filter((t=>"taken"!==t)),E.push(...o),A("computer",E,b)}else e[t].classList.add("empty"),y.textContent="Computer misses!"}),3e3),setTimeout((()=>{v=!0,f.textContent="Your turn!",y.textContent="Please take your turn!",document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",q)))}),5e3))},A=(t,e,o)=>{const n=(n,r)=>{e.filter((t=>t===n)).length===r&&("player"===t?(y.textContent=`You sunk the computer's ${n}`,k=e.filter((t=>t!==n))):"computer"===t&&(y.textContent=`The computer has sunk your ${n}`,E=e.filter((t=>t!==n))),o.push(n))};n("destroyer",2),n("submarine",3),n("cruiser",3),n("battleship",4),n("carrier",5),5===C.length&&(y.textContent="You win!",L=!0),5===b.length&&(y.textContent="You lose!",L=!0)},q=t=>{if(!L){if(t.target.classList.contains("taken")){t.target.classList.add("boom"),y.textContent="Hit!";let e=Array.from(t.target.classList);e=e.filter((t=>"block"!==t)),e=e.filter((t=>"boom"!==t)),e=e.filter((t=>"taken"!==t)),k.push(...e),A("player",k,C)}t.target.classList.contains("taken")||(y.textContent="Miss!",t.target.classList.add("empty")),v=!1,document.querySelectorAll("#computer div").forEach((t=>t.replaceWith(t.cloneNode(!0)))),setTimeout(x,3e3)}},S=document.querySelector(".options-container"),T=document.getElementById("flip-button"),B=document.getElementById("start-button");T.addEventListener("click",(()=>{const t=Array.from(o.children);r=0===r?90:0,t.forEach((t=>t.style.transform=`rotate(${r}deg)`))})),a("player"),a("computer"),n.forEach((t=>i("computer",t))),Array.from(S.children).forEach((t=>t.addEventListener("dragstart",u))),document.querySelectorAll("#player div").forEach((t=>{t.addEventListener("dragover",m),t.addEventListener("drop",p)})),B.addEventListener("click",(()=>{void 0===v&&(0!=g.children.length?y.textContent="Please place all pieces":(document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",q))),v=!0,f.textContent="Your turn!",y.textContent="The game has started!"))}))})();